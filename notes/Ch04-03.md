# GKE Features

### Volumes Again

We can either use a Database as a Service (DBaaS) or use our own Postgres image and PVC in a DIY setup.

### Scaling

There is horizontal and vertical scaling. Vertical scaling involves increasing the resoucres available to a single pod or node, such as adding CPU or memory. Horizontal scaling involves adding more pods or nodes.

The most common reason for scaling a pod is that the number of requests exceeds the number of requests that can be processed.

We can use a HorizontalPodAutoscaler (HPA):

```yaml
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: cpushredder-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cpushredder-dep
  minReplicas: 1
  maxReplicas: 6
  targetCPUUtilizationPercentage: 50
```

If the CPU utilization exceeds the target (50%), an additional replica will be created, up to a maximum of 6.

At the same time, we can scale the number of pods in GKE via the cluster autoscaling feature:
`gcloud container clusters update dwk-cluster --zone=europe-north1-b --enable-autoscaling --min-nodes=1 --max-nodes=5`

Cluster autoscaling can disrupt pods. To solve this, we can use a PodDisruptionBudget:

```yaml
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: example-app-pdb
spec:
  maxUnavailable: 50%
  selector:
    matchLabels:
      app: example-app
```

This config would ensure that no more than 50% of the pods are unavailable at any given time.

We can also scale an individual node with a VerticalPodAutoscaler.
