# Configuring Applications

K8s has two resources for config management: ConfigMaps and Secrets.

Secrets are for sensitive info given to the containers at runtime. ConfigMaps are may contain any kind of config. Both can be used to add environment variables to a container.

### Secrets

For example, let's add images from pixabay to a simple web app. We will need an API Key, which we can store in a Secret.

The env is defined as a secret in the deployment:

```yaml
# ...
containers:
  - name: image-server
    env:
      - name: API_KEY # ENV name passed to container
        valueFrom:
          secretKeyRef:
            name: pixabay-apikey
            key: API_KEY # ENV name in the secret
```

The secret will be defined in a secret.yaml file:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: pixabay-apikey
data:
  API_KEY: vaHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWRRdzR3OVdnWGNR
```

Of course it would be a bad idea to store the API Key this way. Cloud providers have Secrets Managers that can be used to store secrets. A k8s native solution is SealedSecrets, but we will use SOPS+age to encrypt the Secret.

### ConfigMaps

ConfigMaps are similar to Secrets, but the data doesn't have to be encoded and it is not encrypted.

Let's say we have a game server that takes a config file serverconfig.txt:

```yaml
maxplayers=12
difficulty=2
```

We can use a ConfigMap to contain the file:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: game-config
data:
  serverconfig.txt: |
    maxplayers=12
    difficulty=2
```

Now it can be added to the container as a volume. If we edit the txt file and apply the ConfigMap, the game server will reflect the changes.
