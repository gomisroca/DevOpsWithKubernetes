# Organizing a Cluster

### Namespaces

There can be a lot of resources in a cluster, and we want to organize them. Names are used to keep resources separate. I.E. a company that uses one cluster for many projects can use namespaces to split the cluster per project. Most commonly, we use namespaces to separate different environments, such as dev, test, prod, etc.

If a service `cat-pictures` is in a namespace `ns-test`, it can be found from other namespaces via `http://cat-pictures.ns-test`.

We can access namespaces with `-n`, for example to get all the pods in the `kube-system` namespace we can run `kubectl get pods -n kube-system`. To see everything we can use `kubectl get all --all-namespaces`.

We can create a namespace with `kubectl create namespace <namespace-name>`.

To define the namespace of a resource, we add it to the metadata of the yaml file:

```yaml
# ...
metadata:
  namespace: example-namespace
  name: example
# ...
```

If we reuse one namespace a lot, we can set it as default with `kubectl config set-context --current --namespace=<namespace-name>`.

### Labels

Labels are used to separate an app from others inside the same namespace, and to group different resources together. They are key-value pairs and can be modified at any time. They let us humans identify resources.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hashgenerator-dep
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hashgenerator
  template:
    metadata:
      labels:
        app: hashgenerator
    spec:
      containers:
        - name: hashgenerator
          image: jakousa/dwk-app1:b7fc18de2376da80ff0cfc72cf581a9f94d10e64
```

This example includes a selector and a label. The selector and matchLabels direct the instructions of the deployment to pods with the label `app: hashgenerator`.

To group objs with labels we either add it to the yaml file or use `kubectl label <resource-type> <resource-name> <label-key>=<label-value>`.
Labels can then be used to filter resources with `kubectl get <resource-type> -l <label-key>=<label-value>`.

We can move pods to labeled nodes by adding a nodeSelector to the deployment:

```yaml
# ...
spec:
    containers:
    - name: hashgenerator
        image: jakousa/dwk-app1:b7fc18de2376da80ff0cfc72cf581a9f94d10e64
    nodeSelector:
        networkquality: excellent
# ...
```

This will move the pods to nodes with the label `networkquality: excellent`. We would of course need to create the label first and label the nodes.
